[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

# ============================================
# Rsyslog - System/mail logging
# ============================================
[program:rsyslog]
command=/usr/sbin/rsyslogd -n
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/rsyslog.log
stderr_logfile=/var/log/supervisor/rsyslog-error.log

# ============================================
# OpenDKIM - DKIM signing/verification
# Must start before Postfix (Postfix connects to it)
# ============================================
[program:opendkim]
command=/usr/sbin/opendkim -f
autostart=true
autorestart=true
priority=20
stdout_logfile=/var/log/supervisor/opendkim.log
stderr_logfile=/var/log/supervisor/opendkim-error.log

# ============================================
# Postfix - SMTP server
# ============================================
[program:postfix]
command=/usr/sbin/postfix start-fg
autostart=true
autorestart=true
priority=30
startsecs=5
stdout_logfile=/var/log/supervisor/postfix.log
stderr_logfile=/var/log/supervisor/postfix-error.log

# ============================================
# Dovecot - IMAP/POP3/LMTP server
# ============================================
[program:dovecot]
command=/usr/sbin/dovecot -F
autostart=true
autorestart=true
priority=30
startsecs=5
stdout_logfile=/var/log/supervisor/dovecot.log
stderr_logfile=/var/log/supervisor/dovecot-error.log

# ============================================
# Fail2ban - Intrusion prevention
# ============================================
[program:fail2ban]
command=/usr/bin/fail2ban-server -f -x
autostart=true
autorestart=true
priority=40
stdout_logfile=/var/log/supervisor/fail2ban.log
stderr_logfile=/var/log/supervisor/fail2ban-error.log
